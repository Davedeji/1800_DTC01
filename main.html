<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Pro Buddy - Home</title>
  <meta name="Welcome" content="Pro Buddy">

  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
  </script>
  <!-- Google Icons (Material Design)-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Bootstrap FirebaseUI CSS -->


  <!-- Firebase 8 CDNs-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>


  <!-- Link to the api keys for your firebase project -->
  <script src="/scripts/firebaseAPI.js"></script>

  <!-- Header Component-->
  <script src="/components/header.js" type="text/javascript" defer></script>


</head>
<style>
  .container {
    background-color: grey;
  }

  #row1 {
    background-color: red;
  }

  .card {
    height: 200px;
  }

  p {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
  }
</style>


<body>

  <!------------------------------------>
  <!-- Your own HTML layout goes here -->
  <!------------------------------------>

  <div class="container-fluid min-100 d-flex flex-column">
    <div id="nav-placeholder"></div>
    <div class="row gutters-sm">
      <h2>Active Match</h2>
      <div class="col mb-3">
        <div class="card">
          <div class="card-body">
            <div class="d-flex flex-row align-items-center text-start">
              <img src="https://bootdey.com/img/Content/avatar/avatar7.png" alt="Admin" class="rounded-circle"
                width="150">
              <div class="mx-4">
                <h4 id="matchedUserName">John Doe</h4>
                <p class="text-secondary mb-1" id="matchedUserDescription">Full Stack Developer</p>
              </div>
              <div class="">
                <button class="btn btn-outline-primary">Message</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row" id="check-ins">
      <h2>Recent Check-ins</h2>



    </div>
    <div class="row" id="uploads">
      <h2>Uploads</h2>
      <div class="col-4 mb-3">
        <div class="card">
          <div class="card-body">
            <div class="d-flex flex-column align-items-start text-start">
              <img src="/images/guitar.jpg" alt="Admin" class="" style="width: 100%;">
              <p class="text-left">Title: Jan 14</p>
              <p class="text-left">Date: May 21st, 2020</p>
            </div>
          </div>
        </div>
      </div>



    </div>
  </div>

  <!--------------------------------------------------->
  <!-- Your Javascript Libraries and scripts go here -->
  <!--------------------------------------------------->

  <!-- Option 1: Bootstrap Bundle with Popper -->


</body>
<script>
  function getMatchedUser() {
    firebase.auth().onAuthStateChanged((user) => {
      if (user) {
        var uid = user.uid;
        var docRef = db.collection("users").doc(user.uid)

        docRef.get().then((doc) => {
          if (doc.exists) {
            matchedUserID = doc.data().match
            getMatchedUserProperties(matchedUserID)
          } else {
            console.log("No such document!");
          }
        }).catch((error) => {
          console.log("Error getting document:", error);
        });
      } else {

      }
    });

  }

  function getMatchedUserProperties(userID) {
    name = ""
    description = ""
    var docRef = db.collection("users").doc(userID)

    docRef.get().then((doc) => {
      if (doc.exists) {
        name = doc.data().name
        description = doc.data().description
        updateMatchedUserDisplay(name, description)
      } else {
        console.log("No such document!");
      }
    }).catch((error) => {
      console.log("Error getting document:", error);
    });
  }

  function updateMatchedUserDisplay(name, description) {
    document.getElementById("matchedUserName").innerHTML = name
    document.getElementById("matchedUserDescription").innerHTML = description
  }
  getMatchedUser()

  function getRecentCheckIn() {
    firebase.auth().onAuthStateChanged((user) => {
      if (user) {
        db.collection("checkin").where("User", "==", user.uid).limit(3)
          .get()
          .then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
              // doc.data() is never undefined for query doc snapshots
              console.log(doc.id, " => ", doc.data());
              let date = doc.data().Time
              date = date.toDate()
              let time = date.toLocaleTimeString("en-us", {
                timeStyle: 'short'
              });
              date = date.toLocaleDateString("en-us", {
                dateStyle: 'medium'
              });

              console.log(date)
              console.log(time)
              addCheckinCard("", date, time, doc.data().Notes)
            });
          })
          .catch((error) => {
            console.log("Error getting documents: ", error);
          });
      } else {

      }
    });
  }

  function addCheckinCard(id, date, time, notes) {
    var card = $(createCheckinCard(id, date, time, notes))
    $('#check-ins').append(card);
  }

  function createCheckinCard(id, date, time, notes) {
    return `<div class="col-4 mb-3 ">
    <div class="card" id="${id}">
      <div class="card-body">
        <div class="d-flex flex-column align-items-start text-start">
          <p class="text-left">Date: ${date}</p>
          <p class="font-weight-bold">Time: ${time}</p>
          <p class="font-weight-bold">Notes: ${notes}</p>
        </div>
      </div>
    </div>
  </div>`;
  }
  getRecentCheckIn()

  function getRecentUploads() {
    firebase.auth().onAuthStateChanged((user) => {
      if (user) {
        db.collection("checkin").where("User", "==", user.uid).limit(3)
          .get()
          .then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
              // doc.data() is never undefined for query doc snapshots
              console.log(doc.id, " => ", doc.data());
              let date = doc.data().Time
              date = date.toDate()
              let time = date.toLocaleTimeString("en-us", {
                timeStyle: 'short'
              });
              date = date.toLocaleDateString("en-us", {
                dateStyle: 'medium'
              });

              console.log(date)
              console.log(time)
              addCheckinCard("", date, time, doc.data().Notes)
            });
          })
          .catch((error) => {
            console.log("Error getting documents: ", error);
          });
      } else {

      }
    });
  }
</script>

</html>