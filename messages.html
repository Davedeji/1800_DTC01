<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Pro Buddy - PAGE TITLE Goes Here</title>
    <meta name="Welcome" content="Pro Buddy">

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous">
    </script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> -->
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous">
    </script>


    <!-- Google Icons (Material Design) -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Firebase CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.css" />

    <!-- Firebase Keys -->
    <script src="/scripts/firebaseAPI.js"></script>

    <!-- Custom CSS & JS -->


    <!-- Header Component-->
    <script src="/components/header.js" type="text/javascript" defer></script>


</head>

<body>
    <!-- Import header component in head and use this tag. Done!! -->
    <div id="nav-placeholder"></div>
    <main>
        <div class="card-deck row-cols-2"
            id="cardGroup">

        </div>
        <form>
            <div class="form-row fixed-bottom align-items-center">
                <div class="col-auto">
                    <input type="text" class="form-control mb-2" id="messageInput" placeholder="Type message here">
                </div>
                <div class="col-auto">
                    <button type="button" class="btn btn-primary mb-2" onclick="writeMessage()">Send</button>
                </div>
            </div>
        </form>
    </main>
</body>

<script>
    function getMessages() {
        var docRef = db.collection("messages").doc("message01").collection("messages")
        docRef.onSnapshot((querySnapshot) => {
            querySnapshot.docChanges().forEach((change) => {
                // doc.data() is never undefined for query doc snapshots
                const timeStampDate = change.doc.data().sentAt;
                console.log(timeStampDate)
                const dateInMillis = timeStampDate._seconds * 1000
                var date = new Date(dateInMillis).toDateString() + ' at ' + new Date(dateInMillis).toLocaleTimeString()
                var card = $(createCard("", change.doc.data().messageText), date)
                var element = document.getElementById("cardGroup");
                $('#cardGroup').append(card);
            });
        });
    }
    getMessages();
    // let cardCount = 0
    // let cardData = [
    //     ["Music", "music", "/images/skills_interests/music.jpg"],
    //     ["Nature", "nature", "/images/skills_interests/nature.jpg"],
    //     ["Arts & Crafts", "arts_crafts", "/images/skills_interests/arts_crafts.jpg"],
    //     ["Cooking", "cooking", "/images/skills_interests/cooking.jpg"],
    //     ["Dance", "dance", "/images/skills_interests/dance.jpg"],
    //     ["Film & TV", "film_tv", "/images/skills_interests/film_tv.jpg"],
    // ];
    // while (cardCount < cardData.length) {
    //     var card = $(createCard(cardData[cardCount][0], cardData[cardCount][1],
    //         cardData[cardCount][2]))
    //     var element = document.getElementById("cardGroup");
    //     $('#cardGroup').append(card);
    //     cardCount += 1
    // }

    function writeMessage() {
        const user = firebase.auth().currentUser;
        if (user) {
            // User logged in already or has just logged in.
            var docRef = db.collection("messages").doc("message01").collection("messages");
            docRef.add({
                    "messageText": document.getElementById("messageInput").value,
                    "sentAt": firebase.firestore.Timestamp.fromDate(new Date()),
                    "sentBy": user.uid

                })
                .then(() => {
                    console.log("Document successfully written!");
                    document.getElementById("messageInput").value = ""
                })
                .catch((error) => {
                    console.error("Error writing document: ", error);
                });
        } else {
            // User not logged in or has just logged out.
        }

    }

    function createCard(title, message, sentAt) {
        return `<div class="card" style="width: 18rem;">
        <div class="card-body">
            <h5 class="card-title">${title}</h5>
            <h6 class="card-subtitle mb-2 text-muted">${sentAt}</h6>
            <p class="card-text">${message}</p>
        </div>
    </div>`;
    }
</script>

</html>